const n=require("gulp"),e=require("gulp-sort"),o=require("gulp-iconfont"),t=require("fs"),i=require("svgpath"),r=require("gulp-svgmin");function sortIconFilesNormalized(n,e){return n.replace(/-/g,"~").localeCompare(e.replace(/-/g,"~"),"en-US")}function createIconset(n,e,o=""){let r='<svg xmlns="http://www.w3.org/2000/svg">\n<defs>\n';return e.forEach((function(e){if(-1===e.indexOf(".svg"))return;const a=t.readFileSync(n+e,"utf-8").match(/<path( fill-rule="evenodd" clip-rule="evenodd")* d="([^"]*)"/);if(!a)throw new Error(`Unexpected SVG content: ${e}`);{const n=new i(a[2]).scale(1e3/24,1e3/24).round(0).toString(),t=e.replace(".svg","").replace(/\s/g,"-").toLowerCase(),c=void 0!==a[1]?a[1]:"";r+=`<g id="${o}${t}"><path d="${n}"${c}></path></g>\n`}})),r+="</defs>\n</svg>",r}n.task("icons",(async function(){const i="icons/svg/";let a;n.src(i+"*.svg").pipe(r({plugins:[{removeTitle:!0},{removeViewBox:!1},{cleanupNumericValues:{floatPrecision:6}},{convertPathData:{floatPrecision:6}}]})).pipe(n.dest(i)).on("finish",(function(){t.readdir(i,(function(n,e){if(n)return void console.error(n);e.sort(sortIconFilesNormalized);const o=`/**\n * @license\n * Copyright (c) 2017 - 2022 Vaadin Ltd.\n * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/\n */\nimport '@polymer/iron-iconset-svg/iron-iconset-svg.js';\nimport './version.js';\n\nconst $_documentContainer = document.createElement('template');\n\n$_documentContainer.innerHTML = \`<iron-iconset-svg size="1000" name="lumo">\n${createIconset(i,e)}\n</iron-iconset-svg>\`;\n\ndocument.head.appendChild($_documentContainer.content);\n`;t.writeFile("iconset.js",o,(function(n){if(n)return console.error(n)}));const r=`/**\n * @license\n * Copyright (c) 2017 - 2022 Vaadin Ltd.\n * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/\n */\nimport '@vaadin/icon/vaadin-iconset.js';\nimport './version.js';\n\nconst $_documentContainer = document.createElement('template');\n\n$_documentContainer.innerHTML = \`<vaadin-iconset name="lumo" size="1000">\n${createIconset(i,e,"lumo:")}\n</vaadin-iconset>\`;\n\ndocument.head.appendChild($_documentContainer.content);\n`;t.writeFile("vaadin-iconset.js",r,(function(n){if(n)return console.error(n)}))})),n.src(i+"*.svg").pipe(e({comparator:function(n,e){return sortIconFilesNormalized(n.relative,e.relative)}})).pipe(o({fontName:"lumo-icons",formats:["woff"],fontHeight:1e3,ascent:850,descent:150,fixedWidth:!0,normalize:!0,timestamp:1})).on("glyphs",(function(n){a=n})).pipe(n.dest(".")).on("finish",(function(){const n=t.readFileSync("lumo-icons.woff");let e="/**\n * @license\n * Copyright (c) 2017 - 2022 Vaadin Ltd.\n * This program is available under Apache License Version 2.0, available at https://vaadin.com/license/\n */";e+=`\nimport './version.js';\n\nconst $_documentContainer = document.createElement('template');\n\n$_documentContainer.innerHTML = \`\n  <style>\n    @font-face {\n      font-family: 'lumo-icons';\n      src: url(data:application/font-woff;charset=utf-8;base64,${n.toString("base64")}) format('woff');\n      font-weight: normal;\n      font-style: normal;\n    }\n\n    html {\n`,a.forEach((n=>{const o=n.name.replace(/\s/g,"-").toLowerCase(),t="\\\\"+n.unicode[0].charCodeAt(0).toString(16);e+=`      --lumo-icons-${o}: "${t}";\n`})),e+="    }\n  </style>\n`;\n\ndocument.head.appendChild($_documentContainer.content);\n",t.writeFile("font-icons.js",e,(function(n){if(n)return console.error(n)}));const o=a.map((n=>n.name));t.writeFile("test/glyphs.json",JSON.stringify(o,null,2),(function(n){if(n)return console.error(n)})),t.unlink("lumo-icons.woff",(function(n){if(n)return console.error(n)}))}))}))}));