/**
 * Copyright 2019 Penn State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement as t,html as e,css as r}from"../../../../lit-element/lit-element.js";import{SimpleToolbarBehaviors as o}from"../../../simple-toolbar/simple-toolbar.js";import{SimpleToolbarButtonBehaviors as i}from"../../../simple-toolbar/lib/simple-toolbar-button.js";import{RichTextStyles as n,RichTextToolbarStyles as s}from"../buttons/rich-text-editor-button.js";import"../singletons/rich-text-editor-selection.js";import"../../../absolute-position-behavior/absolute-position-behavior.js";const RichTextEditorToolbarBehaviors=function(t){return class extends(o(t)){static get tag(){return"rich-text-editor-toolbar"}static get miniStyles(){return[r`
          :host {
            position: relative;
            height: 0;
            margin: 0 auto;
            padding: 0;
            border: none;
            background-color: none;
          }
          #container {
            display: flex;
            position: absolute;
            bottom: 0;
            margin: 0 auto;
            padding: 0;
            border: var(--rich-text-editor-border-width, 1px) solid
              var(--rich-text-editor-border-color, #ddd);
            background-color: var(
              --rich-text-editor-bg,
              var(--rich-text-editor-bg, #ffffff)
            );
          }
        `]}static get baseStyles(){return[...super.baseStyles,...n,r`
          :host {
            border: var(--rich-text-editor-border-width, 1px) solid
              var(--rich-text-editor-border-color, #ddd);
            background-color: var(--rich-text-editor-bg, #ffffff);
          }
        `]}static get styles(){return[...this.baseStyles,...super.stickyStyles]}get hasBreadcrumbs(){return!1}get undoButton(){return{command:"undo",icon:"undo",label:"Undo",shortcutKeys:"ctrl+z",type:"rich-text-editor-button"}}get redoButton(){return{command:"redo",icon:"redo",label:"Redo",shortcutKeys:"ctrl+shift+z",type:"rich-text-editor-button"}}get historyButtonGroup(){return{type:"button-group",buttons:[this.undoButton,this.redoButton]}}get formatButton(){return{label:"Format",type:"rich-text-editor-heading-picker"}}get boldButton(){return{command:"bold",icon:"editor:format-bold",label:"Bold",shortcutKeys:"ctrl+b",toggles:!0,type:"rich-text-editor-button"}}get italicButton(){return{command:"italic",icon:"editor:format-italic",label:"Italics",shortcutKeys:"ctrl+i",toggles:!0,type:"rich-text-editor-button"}}get underlineButton(){return{type:"rich-text-editor-underline"}}get removeFormatButton(){return{command:"removeFormat",icon:"editor:format-clear",label:"Erase Format",type:"rich-text-editor-button"}}get basicInlineButtonGroup(){return{type:"button-group",buttons:[this.formatButton,this.boldButton,this.italicButton,this.removeFormatButton]}}get linkButton(){return{icon:"link",label:"Link",shortcutKeys:"ctrl+k",type:"rich-text-editor-link"}}get linkButtonGroup(){return{type:"button-group",buttons:[this.linkButton]}}get cutButton(){return{command:"cut",icon:"content-cut",label:"Cut",shortcutKeys:"ctrl+x",type:"rich-text-editor-button"}}get copyButton(){return{command:"copy",icon:"content-copy",label:"Copy",shortcutKeys:"ctrl+c",type:"rich-text-editor-button"}}get pasteButton(){return{command:"paste",icon:"content-paste",label:"Paste",shortcutKeys:"ctrl+v",type:"rich-text-editor-button"}}get clipboardButtonGroup(){return{type:"button-group",buttons:[this.cutButton,this.copyButton,this.pasteButton]}}get subscriptButton(){return{command:"subscript",icon:"mdextra:subscript",label:"Subscript",toggles:!0,type:"rich-text-editor-button"}}get superscriptButton(){return{command:"superscript",icon:"mdextra:superscript",label:"Superscript",toggles:!0,type:"rich-text-editor-button"}}get scriptButtonGroup(){return{type:"button-group",buttons:[this.subscriptButton,this.superscriptButton]}}get symbolButton(){return{symbolTypes:["symbols"],type:"rich-text-editor-symbol-picker"}}get emojiButton(){return{type:"rich-text-editor-emoji-picker"}}get imageButton(){return{type:"rich-text-editor-image"}}get insertButtonGroup(){return{type:"button-group",buttons:[this.imageButton,this.symbolButton]}}get orderedListButton(){return{command:"insertOrderedList",icon:"editor:format-list-numbered",label:"Ordered List",toggles:!0,type:"rich-text-editor-button"}}get unorderedListButton(){return{command:"insertUnorderedList",icon:"editor:format-list-bulleted",label:"Unordered List",toggles:!0,type:"rich-text-editor-button"}}get blockquoteButton(){return{command:"formatBlock",commandVal:"blockquote",label:"Blockquote",icon:"editor:format-quote",shortcutKeys:"ctrl+'",type:"rich-text-editor-button"}}get indentButton(){return{command:"indent",icon:"editor:format-indent-increase",label:"Increase Indent",shortcutKeys:"ctrl+]",type:"rich-text-editor-button"}}get outdentButton(){return{command:"outdent",icon:"editor:format-indent-decrease",label:"Decrease Indent",shortcutKeys:"ctrl+[",type:"rich-text-editor-button"}}get listIndentButtonGroup(){return{type:"button-group",buttons:[this.orderedListButton,this.unorderedListButton,this.blockquoteButton,this.indentButton,this.outdentButton]}}get saveButton(){return{command:"save",icon:"save",label:"Save",type:"rich-text-editor-button"}}get closeButton(){return{command:"cancel",icon:"close",label:"Cancel",type:"rich-text-editor-button"}}get saveCloseButtonGroup(){return{type:"button-group",buttons:[this.saveButton]}}get sourceButton(){return{type:"rich-text-editor-source-code"}}get sourceButtonGroup(){return{type:"button-group",buttons:[this.sourceButton]}}get defaultConfig(){return[this.historyButtonGroup,this.basicInlineButtonGroup,this.linkButtonGroup,this.clipboardButtonGroup,this.scriptButtonGroup,this.insertButtonGroup,this.listIndentButtonGroup]}get miniConfig(){return[{type:"button-group",buttons:[this.boldButton,this.italicButton,this.removeFormatButton]},this.linkButtonGroup,this.scriptButtonGroup,{type:"button-group",buttons:[this.orderedListButton,this.unorderedListButton]}]}get miniTemplate(){return e` <div id="container">${super.toolbarTemplate}</div> `}get toolbarTemplate(){return super.toolbarTemplate}render(){return this.toolbarTemplate}static get properties(){return{...super.properties,breadcrumbsLabel:{name:"breadcrumbsLabel",type:String,attribute:"breadcrumbs-label"},breadcrumbsSelectAllLabel:{name:"breadcrumbsSelectAllLabel",type:String,attribute:"breadcrumbs-select-all-label"},editor:{name:"editor",type:Object,attribute:"editor"},id:{name:"id",type:String,attribute:"id",reflect:!0},savedSelection:{name:"savedSelection",type:Object},range:{name:"range",type:Object},registered:{type:Boolean},selectedNode:{type:Object},selectionAncestors:{type:Array},show:{type:String,attribute:"show",reflect:!0},clickableElements:{name:"clickableElements",type:Object},__pasteDisabled:{name:"__pasteDisabled",type:Boolean,attribute:"paste-disabled",reflect:!0},__promptOpen:{name:"__promptOpen",type:Boolean},__selection:{type:Object}}}constructor(){super(),import("../buttons/rich-text-editor-source-code.js"),import("../buttons/rich-text-editor-heading-picker.js"),import("../buttons/rich-text-editor-symbol-picker.js"),import("../buttons/rich-text-editor-underline.js"),import("../buttons/rich-text-editor-image.js"),import("../buttons/rich-text-editor-link.js"),this.config=this.defaultConfig,this.clickableElements={},this.breadcrumbsLabel="Select",this.breadcrumbsSelectAllLabel="All"}firstUpdated(t){super.firstUpdated(t),this.__selection=window.RichTextEditorSelection.requestAvailability(),this.register(),this.hasBreadcrumbs&&this._addBreadcrumbs()}updated(t){super.updated(t),t.forEach(((t,e)=>{"range"===e&&this._rangeChange(),"editor"===e&&this._editorChange(),["editor","show","range"].includes(e)&&(this.hidden=this.disconnected),["breadcrumbs","sticky"].includes(e)&&this.breadcrumbs&&(this.breadcrumbs.sticky=this.sticky)}))}connectedCallback(){super.connectedCallback(),this.register()}disconnectedCallback(){super.disconnectedCallback(),this.register(!0)}get controls(){return this.editor?this.editor.getAttribute("id"):void 0}get disconnected(){return"always"!=this.show&&("selection"!=this.show?!this.editor:this.noSelection)}get noSelection(){return!this.range||this.range.collapsed}cancel(){this.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}close(){this.dispatchEvent(new CustomEvent("disableediting",{bubbles:!0,cancelable:!0,composed:!0,detail:this})),this.editor=void 0,document.body.append(this)}highlight(t=!0){this.dispatchEvent(new CustomEvent("highlight",{bubbles:!0,cancelable:!0,composed:!0,detail:t}))}register(t=!1){window.dispatchEvent(new CustomEvent("register",{bubbles:!0,cancelable:!0,composed:!0,detail:{remove:t,toolbar:this}}))}setRange(t){this.dispatchEvent(new CustomEvent("setrange",{bubbles:!0,cancelable:!0,composed:!0,detail:{editor:this.editor,range:t}}))}selectNode(t){this.dispatchEvent(new CustomEvent("selectnode",{bubbles:!0,cancelable:!0,composed:!0,detail:t}))}selectNodeContents(t){this.dispatchEvent(new CustomEvent("selectnodecontents",{bubbles:!0,cancelable:!0,composed:!0,detail:t}))}selectRange(t){this.dispatchEvent(new CustomEvent("selectrange",{bubbles:!0,cancelable:!0,composed:!0,detail:t}))}newEditor(t){let e=document.createElement("rich-text-editor");t.parentNode.insertBefore(e,t),e.appendChild(t)}pasteFromClipboard(){this.dispatchEvent(new CustomEvent("pastefromclipboard",{bubbles:!0,cancelable:!0,composed:!0,detail:this.editor}))}clearToolbar(){super.clearToolbar&&super.clearToolbar(),this.clickableElements={}}deregisterButton(t){super.deregisterButton&&super.deregisterButton(t),(t.tagsArray||[]).forEach((t=>delete this.clickableElements[t]))}registerButton(t){super.registerButton&&super.registerButton(t),"paste"!==t.command||navigator.clipboard?(t.disabled=!this.editor,(t.tagsArray||[]).forEach((e=>this.clickableElements[e]=e=>t.tagClickCallback(e)))):t.remove()}_addBreadcrumbs(){this.breadcrumbs||(this.breadcrumbs=document.createElement("rich-text-editor-breadcrumbs"),this.breadcrumbs.onselectnode=t=>this._selectNode(t.detail),document.body.appendChild(this.breadcrumbs),this.breadcrumbs.addEventListener("breadcrumb-click",this._handleBreadcrumb.bind(this))),this.breadcrumbs.label=this.breadcrumbsLabel}_handleBreadcrumb(t){this.editor&&this.range?t.detail.selectAll?this.selectNodeContents(this.editor):this.selectNode(t.detail):this._rangeChange()}_handleButtonUpdate(t){super._handleButtonUpdate&&super._handleButtonUpdate(t)}_editorChange(){this.breadcrumbs&&(this.breadcrumbs.controls=this.controls,this.editor&&this.editor.parentNode.insertBefore(this.breadcrumbs,this.editor.nextSibling)),this.buttons.forEach((t=>{"close"!==t.command&&(t.disabled=!this.editor)})),this.range=void 0}_rangeChange(){if(this.range&&this.range.commonAncestorContainer&&this.editor&&this.editor.contains(this.range.commonAncestorContainer)){let t=this.range.commonAncestorContainer,e=1==t.nodeType?t:t.parentNode,r=[],getParentNode=t=>{r.push(t),t.parentNode&&t.parentNode!==this.editor&&getParentNode(t.parentNode)};e!==this.editor&&getParentNode(e),r.push({nodeName:this.breadcrumbsSelectAllLabel,selectAll:!0}),this.selectedNode=r[0],this.selectionAncestors=r.reverse(),(this.buttons||[]).forEach((t=>{t.range=void 0,t.range=this.range,t.selectedNode=this.selectedNode,t.selectionAncestors=this.selectionAncestors})),this.breadcrumbs&&(this.breadcrumbs.selectionAncestors=this.selectionAncestors,this.breadcrumbs.hidden=this.disconnected)}}}};class RichTextEditorToolbar extends(RichTextEditorToolbarBehaviors(t)){}window.customElements.define(RichTextEditorToolbar.tag,RichTextEditorToolbar);export{RichTextEditorToolbar,RichTextEditorToolbarBehaviors};