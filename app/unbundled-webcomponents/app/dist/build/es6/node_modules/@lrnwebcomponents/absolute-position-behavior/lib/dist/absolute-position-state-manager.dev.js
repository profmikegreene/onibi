Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbsolutePositionStateManager=void 0;var t=require("lit-element/lit-element.js");function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _get(t,e,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,e,o){var n=function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(o):i.value}})(t,e,o||t)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,e){return t.__proto__=e,t})(t,e)}window.AbsolutePositionStateManager=window.AbsolutePositionStateManager||{},window.AbsolutePositionStateManager.requestAvailability=function(){if(!window.AbsolutePositionStateManager.instance){window.AbsolutePositionStateManager.instance=document.createElement("absolute-position-state-manager");var t=window.AbsolutePositionStateManager.instance;document.body.appendChild(t)}return window.AbsolutePositionStateManager.instance};var e=function(e){function AbsolutePositionStateManager(){var t;return function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,AbsolutePositionStateManager),(t=_possibleConstructorReturn(this,_getPrototypeOf(AbsolutePositionStateManager).call(this))).elements=[],t.__timeout=!1,t.__observer=new MutationObserver((function(e){return t.checkMutations(e)})),t}return function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}(AbsolutePositionStateManager,t.LitElement),_createClass(AbsolutePositionStateManager,null,[{key:"tag",get:function get(){return"absolute-position-state-manager"}},{key:"properties",get:function get(){return{elements:{type:Array},__observer:{type:Object},__timeout:{type:Object}}}}]),_createClass(AbsolutePositionStateManager,[{key:"loadElement",value:function loadElement(t){this.elements.length<1&&(this.__observer.observe(document,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.updateElements(),document.addEventListener("load",this.updateElements),window.addEventListener("resize",this._handleResize)),this.elements.push(t),t.style.top=0,t.style.left=0,this.positionElement(t)}},{key:"unloadElement",value:function unloadElement(t){this.elements.filter((function(e){return e===t})),this.elements.length<1&&this.removeEventListeners()}},{key:"_handleResize",value:function _handleResize(){this.__timeout&&clearTimeout(this.__timeout),this.__timeout=setTimeout(window.AbsolutePositionStateManager.instance.updateElements(),250)}},{key:"checkMutations",value:function checkMutations(t){var e=this,o=!1;t.forEach((function(t){o||(o=o||!("attributes"===t.type&&"style"===t.attributeName&&e.elements.includes(t.target)))})),o&&this.updateElements()}},{key:"findTarget",value:function findTarget(t){for(var e="#"+t.for,o=t.target,n=t;t.for&&!o&&n&&n.parentNode&&n!==document;)o=(n=n.parentNode)?n.querySelector(e):void 0,11===n.nodeType&&(n=n.host),o=!o&&n?n.querySelector(e):o;return o}},{key:"removeEventListeners",value:function removeEventListeners(){this.__observer&&this.__observer.disconnect&&this.__observer.disconnect(),document.removeEventListener("load",this.updateElements),window.removeEventListener("resize",this._handleResize)}},{key:"updateElements",value:function updateElements(){var t=this;this.elements.forEach((function(e){return t.positionElement(e)}))}},{key:"_getParentNode",value:function _getParentNode(t){var e=t.parentNode;return null!=e&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e}},{key:"positionElement",value:function positionElement(t){t.position||(t.position="bottom");var e=this.findTarget(t),o=t.offsetParent,n=!e||e.getBoundingClientRect();if(e&&o){t.justify&&(t.style.width="".concat(n.width,"px"));var i=parseFloat(t.offset),r=document.body.getBoundingClientRect(),s=o.getBoundingClientRect(),a=t.getBoundingClientRect(),l=function vertical(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.position;return"left"!==e&&"right"!==e},u=function before(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.position;return"left"===e||"top"===e},c=function setAlign(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l(t.position),o=function pxToNum(t){return parseFloat(t.replace("px",""))},i=e?o(t.style.left)-a.left:o(t.style.top)-a.top,s=e?"left":"top",u=function distance(t){return e?t.width:t.height},c=i+u(r)-u(a),p=i;return"end"===t.positionAlign?p+=n[s]-u(a)+u(n):"start"===t.positionAlign?p+=n[s]:p+=n[s]-u(a)/2+u(n)/2,t.fitToVisibleBounds?Math.max(i,Math.min(c,p))+"px":p+"px"},p=function getCoord(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.position,o=function pxToNum(t){return parseFloat(t.replace("px",""))},r=l(e)?o(t.style.top)-a.top:o(t.style.left)-a.left,s="visible"==window.getComputedStyle(t,null).overflowY?Math.max(a.height,t.scrollHeight):a.height,u="visible"==window.getComputedStyle(t,null).overflowX?Math.max(a.width,t.scrollWidth):a.width;return"top"===e?n.top+r-s-i+"px":"left"===e?n.left+r-u-i+"px":n[e]+r+i+"px"},f=function isFit(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.position,o=function distance(t){return l(e)?a.height+i:a.width+i};return u(e)?n[e]-r[e]>o:r[e]-n[e]>o},d=!1!==t.fitToVisibleBounds&&!f(t.position),h={top:["bottom","left","right"],left:["right","top","bottom"],bottom:["top","right","left"],right:["left","bottom","top"]};t.style.position="absolute",d&&f(h[t.position][0])?t.position=h[t.position][0]:d&&f(h[t.position][1])?t.position=h[t.position][1]:d&&f(h[t.position][2])?t.position=h[t.position][2]:(t.style.top=l(t.position)?p():c(),t.style.left=l(t.position)?c():p(),t.__positions={self:a,parent:s,target:n})}}},{key:"disconnectedCallback",value:function disconnectedCallback(){this.removeEventListeners(),_get(_getPrototypeOf(AbsolutePositionStateManager.prototype),"disconnectedCallback",this).call(this)}}]),AbsolutePositionStateManager}();exports.AbsolutePositionStateManager=e,window.customElements.define(e.tag,e);